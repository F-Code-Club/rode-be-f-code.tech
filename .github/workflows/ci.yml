on:
  pull_request:
    types: ["opened", "reopened"] 
    branches: 
      - '*/features/**'
      - '*/bugfix/**'
      - '*/perf/**'
      - '*/feature/**'
      - '*/bugfixes/**'
# refactor, bugfix, perf
jobs:
  code-unit-testing:
    name: Clean Code Testing
    runs-on: ubuntu-latest
    steps:
    - name: Checking out
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: SonarQube Scan
      uses: sonarsource/sonarqube-scan-action@master
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

    - name: SonarQube Code Quality
      uses: sonarsource/sonarqube-quality-gate-action@master
      timeout-minutes: 5
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

    - name: Comment on PR if tests fail
      if: failure()
      uses: actions/github-script@v6
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const { context } = require('@actions/github');
          const issueComment = context.issue.number
          await github.issues.createComment({
            issue_number: issueComment,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'ðŸš¨ The SonarQube Test have failed. Please check the details and fix the issues.'
          });



